<!DOCTYPE html>
<html lang="en">
    <head id="head">
        <script>
            // setInterval(() => {
            //     console.log('checking for error IFRAME');
            //     const IF = document.querySelector('body > iframe');
            //     if (IF) {
            //         IF.style.pointerEvents = 'none';
            //         IF.style.opacity = '0.3';
            //     }
            // }, 1000);

            window.addEventListener('message', (e) => {
                const data = e.data;
                if (data.type === 'DISPLAY_ERROR') {
                    const IF = document.querySelector('body > iframe');
                    if (IF) {
                        const error = IF.contentDocument?.body?.innerText;
                        const m = error.match(/\/comp\/comp_(bnode_[a-z0-9]+)/);
                        if(m){
                            IF.style.pointerEvents = 'none';
                            IF.style.opacity = '0.2';
                        }
                        else{
                            
                        }
                    }
                }
            });
        </script>

        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
            rel="stylesheet"
        />

        <script src="https://cdn.tailwindcss.com"></script>

        <script>
            tailwind.config = {
                darkMode: 'class',
                theme: {
                    extend: {
                        colors: {
                            clifford: '#da373d',
                        }
                    }
                }
            }
        </script>

        <!-- dark-mode -->
        <script>
            (()=>{
                const setup_darkmode = () => {
                    const EL = document.body;
                    const IS_DARK = window.matchMedia('(prefers-color-scheme:dark)').matches; // boolean
                    if(IS_DARK) EL.classList.add('dark');
                    if(!IS_DARK) EL.classList.remove('dark');
                    
                    window.matchMedia('(prefers-color-scheme:dark)').addEventListener('change', e=>{
                        if(e.matches) { // user switched to dark theme
                            EL.classList.add('dark');
                        } else { // user switched to light theme
                            EL.classList.remove('dark');
                        }
                    })
                }
                setup_darkmode();
            })();
        </script>

        <link
            id="feedback-style"
            rel="stylesheet"
            href="https://stdlib.brokenatom.io/module/test/v39/feedback-style.css"
        />
        <script
            id="stdlib-script"
            src="https://stdlib.brokenatom.io/module/test/v39/online-offline.js"
        ></script>


        <style id="relay-css">
            .animate-all-for-sometime * {
                transition: all 0.1s ease-in-out;
            }

            .edit-mode * {
                cursor: default;
                user-select: none;
            }
        </style>


        <script>
            const send_message = (data) => {
                window.parent.parent?.postMessage(data, '*');
            };

            const tim = setInterval(()=>{
                const data = {
                    type: "req_for_relay_js"
                }
                send_message(data);
            }, 1000);

            const listen_msg = (e)=>{
                const data = e.data;
                if (data.type === 'relay_js') {
                    const code = data.code;
                    if(code){
                        // console.log("relay js", code);
                        clearInterval(tim);
                        window.removeEventListener("message", listen_msg);

                        try {
                            const s = document.createElement("script");
                            s.id = "relay-js";
                            s.text = code;
                            document.head.append(s);
                        } catch (error) {
                            console.log("error while adding relay js", error);
                        }
                    }
                }

            }
            window.addEventListener('message', listen_msg);
        </script>

        <!-- {TEMPLATE_HEAD_CONTENTS} -->
    </head>

    <body style="overflow: hidden; user-select: none; background-color: rgb(228 228 231);">
        <div id="root"></div>

        <!-- <div id="dot" style="width: 8px; height: 8px; top: 0px; left: 0px; background: darksalmon; position: absolute; border-radius: 50%; pointer-events: none;"></div> -->
    </body>
</html>
